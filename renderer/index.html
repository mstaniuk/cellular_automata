<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Title</title>
  <style>
    html,
    body {
      margin: 0;
      padding: 0;
    }

    body {
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
    }

    canvas {
      display: block;
    }
  </style>
</head>
<body>
<button id="toggle">Start/stop</button>
<canvas id="canvas"></canvas>

<script>
  ;(function() {
    let isAnimating = false;
    let lastTime = 0;
    let deltaTime = 0;
    const CELL_SIZE = 20;
    const WORLD_SIZE = 20;
    const toggleButton = document.getElementById('toggle');
    const canvas = document.getElementById('canvas');
    canvas.width = WORLD_SIZE*CELL_SIZE;
    canvas.height = WORLD_SIZE*CELL_SIZE;
    const ctx = canvas.getContext('2d');
    const world = (new Array(WORLD_SIZE).fill(0)).map(() => new Array(WORLD_SIZE).fill(0));

    function update(timestamp) {
      deltaTime = timestamp - lastTime;
      lastTime = timestamp;

      for(let x = 0; x < WORLD_SIZE; x++) {
        for(let y = 0; y < WORLD_SIZE; y++) {
          world[x][y] = Math.random() > 0.6 ? 1 : 0;
        }
      }
    }

    function render() {
      // Log dt and fps
      // console.log(deltaTime, 1/deltaTime * 1000);
      ctx.clearRect(0, 0, WORLD_SIZE*CELL_SIZE, WORLD_SIZE*CELL_SIZE);
      for(let x = 0; x < WORLD_SIZE; x++) {
        for(let y = 0; y < WORLD_SIZE; y++) {
          if (world[x][y]) {
            ctx.strokeRect(x*CELL_SIZE, y*CELL_SIZE, CELL_SIZE, CELL_SIZE);
          }
        }
      }
    }

    function tick(timestamp) {
      update(timestamp);
      render();

      window.requestAnimationFrame((ts) => {
        if(isAnimating) {
          tick(ts);
        }
      });
    }

    toggleButton.addEventListener('click', () => {
      isAnimating = !isAnimating;
      lastTime = performance.now();
      tick(lastTime);
    })

  }())
</script>
</body>
</html>
